import{c as i,a as m,b as s,t as l,F as f,r as g,n as q,d as y,o as a,e as V,w as E,v as x,f as D,g as Y,h as z}from"./vue-BxR9R55p.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function r(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(t){if(t.ep)return;t.ep=!0;const n=r(t);fetch(t.href,n)}})();const U=(o,e)=>{const r=o.__vccOpts||o;for(const[c,t]of e)r[c]=t;return r},H={name:"GameRoom",props:{roomId:{type:String,required:!0},user:{type:Object,required:!0}},emits:["back-to-rooms","update-balance"],data(){return{loading:!0,room:null,gameState:null,previewCartela:null,playerCartela:null,playerJoined:!1,showWinnerModal:!1,isWinner:!1,winAmount:0,notification:null,gameInterval:null}},computed:{markedCount(){var e;if(!this.playerCartela||!((e=this.gameState)!=null&&e.drawnNumbers))return 0;let o=0;for(let r=0;r<5;r++)for(let c=0;c<5;c++)r===2&&c===2||this.gameState.drawnNumbers.includes(this.playerCartela[r][c])&&o++;return o}},async created(){await this.loadRoom(),await this.loadGameState(),this.generateNewCard(),this.loading=!1,this.startGamePolling()},beforeUnmount(){this.gameInterval&&clearInterval(this.gameInterval)},methods:{async loadRoom(){try{const o=await fetch(`/api/room/${this.roomId}`);o.ok&&(this.room=await o.json(),this.room.playerCount=this.room.players.length)}catch(o){console.error("Failed to load room:",o)}},async loadGameState(){try{const o=await fetch(`/api/game-state/${this.roomId}`);if(o.ok){const e=this.gameState;this.gameState=await o.json();const r=this.gameState.room.players.find(c=>c.userId===this.$userId);r&&(this.playerJoined=!0,this.playerCartela=r.cartela,this.gameState.room.winner&&!this.showWinnerModal&&this.handleGameEnd()),this.room=this.gameState.room,this.room.playerCount=this.room.players.length}}catch(o){console.error("Failed to load game state:",o)}},generateNewCard(){const o=[],e=[{min:1,max:15},{min:16,max:30},{min:31,max:45},{min:46,max:60},{min:61,max:75}];for(let r=0;r<5;r++){const c=[];for(;c.length<5;){const t=Math.floor(Math.random()*(e[r].max-e[r].min+1))+e[r].min;c.includes(t)||c.push(t)}c.sort((t,n)=>t-n),o.push(c)}this.previewCartela=o},async joinGame(){if(!this.previewCartela||this.user.balance<this.room.betAmount){this.showNotification("Cannot join game!","error");return}try{const o=await fetch("/api/join-room",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.$userId,roomId:this.roomId})}),e=await o.json();o.ok?(this.playerJoined=!0,this.playerCartela=e.cartela,this.$emit("update-balance",e.balance),this.showNotification("Successfully joined the game!","success"),await this.loadGameState()):this.showNotification(e.error||"Failed to join game","error")}catch(o){console.error("Join game error:",o),this.showNotification("Failed to join game","error")}},async startGame(){try{const o=await fetch("/api/start-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:this.roomId})}),e=await o.json();o.ok?(this.showNotification("Game started!","success"),await this.loadGameState()):this.showNotification(e.error||"Failed to start game","error")}catch(o){console.error("Start game error:",o),this.showNotification("Failed to start game","error")}},isNumberMarked(o,e,r){var c,t;return o===2&&e===2?!0:((t=(c=this.gameState)==null?void 0:c.drawnNumbers)==null?void 0:t.includes(r))||!1},handleGameEnd(){const o=this.gameState.room.winner;if(o){if(this.isWinner=o.userId===this.$userId,this.isWinner){const e=this.gameState.room.players.length*this.gameState.room.betAmount;this.winAmount=Math.floor(e*.9),this.$emit("update-balance",this.user.balance+this.winAmount)}this.showWinnerModal=!0}},closeWinnerModal(){this.showWinnerModal=!1},startGamePolling(){this.gameInterval=setInterval(()=>{this.loadGameState()},2e3)},showNotification(o,e="info"){this.notification={message:o,type:e},setTimeout(()=>{this.notification=null},5e3)}}},K={class:"game-room"},Q={key:0,class:"loading"},X={key:1,class:"game-layout"},Z={class:"game-header"},$={class:"room-info"},ee={class:"user-balance"},te={class:"game-content"},se={class:"left-panel"},oe={key:0,class:"cartela-selection"},ie={class:"generated-cartela"},ae={key:0,class:"bingo-card preview"},ne={class:"card-grid"},re=["disabled"],le={key:1,class:"player-status"},de={class:"players-list"},ce={class:"player-list"},ue={class:"center-panel"},me={class:"bingo-machine"},he={key:0,class:"current-number"},pe={class:"number-display"},we={key:1,class:"waiting-display"},fe={class:"status-message"},ge={key:2,class:"drawn-numbers"},ye={class:"numbers-grid"},be={key:3,class:"game-actions"},ve=["disabled"],_e={key:0,class:"min-players-msg"},ke={class:"right-panel"},Ce={key:0,class:"player-cartela"},Ne={class:"bingo-card active"},Se={class:"card-grid"},We={class:"card-stats"},Ae={class:"progress-bar"},Re={key:1,class:"no-card"},Ge={key:2,class:"modal-overlay"},Pe={class:"winner-modal"},Ie={key:0},Me={key:1},je={key:2,class:"winner-message"},Be={key:3,class:"game-over-message"},Oe={class:"winner-actions"};function Te(o,e,r,c,t,n){var p,b,v,_,k,C,N,S,d,W,R,G,P,I,M,j,B,O,T,F;return a(),i("div",K,[t.loading?(a(),i("div",Q,[...e[6]||(e[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading game room...",-1)])])):(a(),i("div",X,[s("header",Z,[s("button",{onClick:e[0]||(e[0]=u=>o.$emit("back-to-rooms")),class:"back-btn"}," â† Back to Rooms "),s("div",$,[s("h2",null,l(((p=t.room)==null?void 0:p.name)||"Bingo Room"),1),s("p",null,"Bet: "+l(((b=t.room)==null?void 0:b.betAmount)||0)+" coins | Players: "+l(((v=t.room)==null?void 0:v.playerCount)||0)+"/"+l(((_=t.room)==null?void 0:_.maxPlayers)||0),1)]),s("div",ee," Balance: "+l(((k=r.user)==null?void 0:k.balance)||0)+" coins ",1)]),s("main",te,[s("div",se,[e[12]||(e[12]=s("h3",null,"ðŸŽ¯ Available Cartelas",-1)),t.playerJoined?(a(),i("div",le,[e[10]||(e[10]=s("p",{class:"joined-message"},"âœ… You've joined the game!",-1)),e[11]||(e[11]=s("p",{class:"waiting-message"},"Waiting for game to start...",-1)),s("div",de,[e[9]||(e[9]=s("h4",null,"Players in Room:",-1)),s("div",ce,[(a(!0),i(f,null,g(((d=t.gameState)==null?void 0:d.players)||[],u=>(a(),i("div",{key:u.username,class:y(["player-item",{winner:u.hasWon}])},l(u.username)+" "+l(u.hasWon?"ðŸ†":""),3))),128))])])])):(a(),i("div",oe,[s("div",ie,[e[8]||(e[8]=s("h4",null,"Your Bingo Card",-1)),t.previewCartela?(a(),i("div",ae,[e[7]||(e[7]=s("div",{class:"card-header"},[s("span",null,"B"),s("span",null,"I"),s("span",null,"N"),s("span",null,"G"),s("span",null,"O")],-1)),s("div",ne,[(a(!0),i(f,null,g(t.previewCartela,(u,h)=>(a(),i("div",{key:`col-${h}`,class:"card-column"},[(a(!0),i(f,null,g(u,(A,w)=>(a(),i("div",{key:`${h}-${w}`,class:y(["card-cell",{free:h===2&&w===2}])},l(h===2&&w===2?"FREE":A),3))),128))]))),128))])])):m("",!0),t.playerJoined?m("",!0):(a(),i("button",{key:1,onClick:e[1]||(e[1]=(...u)=>n.generateNewCard&&n.generateNewCard(...u)),class:"regenerate-btn"}," ðŸ”„ Generate New Card ")),t.playerJoined?m("",!0):(a(),i("button",{key:2,onClick:e[2]||(e[2]=(...u)=>n.joinGame&&n.joinGame(...u)),class:"play-btn",disabled:!t.previewCartela||((C=r.user)==null?void 0:C.balance)<((N=t.room)==null?void 0:N.betAmount)}," ðŸŽ® Play ("+l(((S=t.room)==null?void 0:S.betAmount)||0)+" coins) ",9,re))])]))]),s("div",ue,[s("div",me,[e[14]||(e[14]=s("h3",null,"ðŸŽ° Bingo Machine",-1)),((R=(W=t.gameState)==null?void 0:W.drawnNumbers)==null?void 0:R.length)>0?(a(),i("div",he,[s("div",pe,l(t.gameState.drawnNumbers[t.gameState.drawnNumbers.length-1]),1),e[13]||(e[13]=s("p",null,"Latest Number",-1))])):(a(),i("div",we,[s("div",fe,l(((G=t.room)==null?void 0:G.status)==="waiting"?"Waiting for players...":"Game starting soon..."),1)])),((I=(P=t.gameState)==null?void 0:P.drawnNumbers)==null?void 0:I.length)>0?(a(),i("div",ge,[s("h4",null,"Called Numbers ("+l(t.gameState.drawnNumbers.length)+"/25)",1),s("div",ye,[(a(!0),i(f,null,g(t.gameState.drawnNumbers,u=>(a(),i("div",{key:u,class:"drawn-number"},l(u),1))),128))])])):m("",!0),t.playerJoined&&((M=t.room)==null?void 0:M.status)==="waiting"?(a(),i("div",be,[s("button",{onClick:e[3]||(e[3]=(...u)=>n.startGame&&n.startGame(...u)),class:"start-game-btn",disabled:(((j=t.room)==null?void 0:j.playerCount)||0)<2}," ðŸš€ Start Game ",8,ve),(((B=t.room)==null?void 0:B.playerCount)||0)<2?(a(),i("p",_e," Need at least 2 players to start ")):m("",!0)])):m("",!0)])]),s("div",ke,[e[17]||(e[17]=s("h3",null,"ðŸŽ¯ Your Card",-1)),t.playerCartela?(a(),i("div",Ce,[s("div",Ne,[e[15]||(e[15]=s("div",{class:"card-header"},[s("span",null,"B"),s("span",null,"I"),s("span",null,"N"),s("span",null,"G"),s("span",null,"O")],-1)),s("div",Se,[(a(!0),i(f,null,g(t.playerCartela,(u,h)=>(a(),i("div",{key:`player-col-${h}`,class:"card-column"},[(a(!0),i(f,null,g(u,(A,w)=>(a(),i("div",{key:`player-${h}-${w}`,class:y(["card-cell",{free:h===2&&w===2,marked:n.isNumberMarked(h,w,A)}])},l(h===2&&w===2?"FREE":A),3))),128))]))),128))])]),s("div",We,[s("p",null,"Marked: "+l(n.markedCount)+"/24",1),s("div",Ae,[s("div",{class:"progress-fill",style:q({width:`${n.markedCount/24*100}%`})},null,4)])])])):(a(),i("div",Re,[...e[16]||(e[16]=[s("p",null,"Join the game to see your card!",-1)])]))])])])),t.showWinnerModal?(a(),i("div",Ge,[s("div",Pe,[e[18]||(e[18]=s("div",{class:"confetti"},"ðŸŽ‰",-1)),t.isWinner?(a(),i("h2",Ie,"ðŸ† Congratulations!")):(a(),i("h2",Me,"ðŸŽ® Game Over")),t.isWinner?(a(),i("p",je," You won "+l(t.winAmount)+" coins! ",1)):(a(),i("p",Be,l(((F=(T=(O=t.gameState)==null?void 0:O.room)==null?void 0:T.winner)==null?void 0:F.username)||"Someone")+" won this round! ",1)),s("div",Oe,[s("button",{onClick:e[4]||(e[4]=(...u)=>n.closeWinnerModal&&n.closeWinnerModal(...u)),class:"continue-btn"}," Continue Playing "),s("button",{onClick:e[5]||(e[5]=u=>o.$emit("back-to-rooms")),class:"rooms-btn"}," Back to Rooms ")])])])):m("",!0),t.notification?(a(),i("div",{key:3,class:y(["notification",t.notification.type])},l(t.notification.message),3)):m("",!0)])}const Fe=U(H,[["render",Te],["__scopeId","data-v-43a8fa8d"]]),Je={name:"App",components:{GameRoom:Fe},data(){return{loading:!0,user:null,rooms:[],currentView:"rooms",currentRoomId:null,showWithdrawModal:!1,withdrawAmount:null,notification:null,username:this.$username}},async created(){await this.loadUserData(),await this.loadRooms(),this.loading=!1,this.pollRooms()},methods:{async loadUserData(){try{const o=await fetch(`/api/user/${this.$userId}`);o.ok&&(this.user=await o.json())}catch(o){console.error("Failed to load user data:",o)}},async loadRooms(){try{const o=await fetch("/api/rooms");o.ok&&(this.rooms=await o.json())}catch(o){console.error("Failed to load rooms:",o)}},async joinRoom(o){const e=this.rooms.find(r=>r.id===o);if(e){if(e.playerCount>=e.maxPlayers){this.showNotification("Room is full!","error");return}if(this.user.balance<e.betAmount){this.showNotification("Insufficient balance!","error");return}this.currentRoomId=o,this.currentView="game"}},backToRooms(){this.currentView="rooms",this.currentRoomId=null,this.loadUserData(),this.loadRooms()},updateUserBalance(o){this.user&&(this.user.balance=o)},requestWithdraw(){var o;if(!((o=this.user)!=null&&o.balance)){this.showNotification("No balance to withdraw!","error");return}this.withdrawAmount=null,this.showWithdrawModal=!0},async submitWithdraw(){var o,e;if(!this.withdrawAmount||this.withdrawAmount<=0||this.withdrawAmount>this.user.balance){this.showNotification("Invalid withdrawal amount!","error");return}try{const r=(e=(o=window.Telegram.WebApp.initDataUnsafe)==null?void 0:o.user)==null?void 0:e.id,c=await fetch("/api/withdraw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.$userId,amount:this.withdrawAmount,chatId:r})}),t=await c.json();c.ok?(this.showNotification("Withdrawal request submitted! You will be notified when approved.","success"),this.showWithdrawModal=!1):this.showNotification(t.error||"Failed to submit withdrawal","error")}catch(r){console.error("Withdrawal error:",r),this.showNotification("Failed to submit withdrawal request","error")}},showNotification(o,e="info"){this.notification={message:o,type:e},setTimeout(()=>{this.notification=null},5e3)},pollRooms(){setInterval(()=>{this.currentView==="rooms"&&this.loadRooms()},5e3)}}},Ue={id:"app"},Le={key:0,class:"loading"},qe={key:1,class:"container"},Ve={class:"header"},Ee={class:"user-info"},xe={class:"user-avatar"},De={class:"user-details"},Ye={class:"balance"},ze=["disabled"],He={class:"main-content"},Ke={class:"rooms-grid"},Qe=["onClick"],Xe={class:"room-header"},Ze={class:"room-details"},$e={class:"detail-item"},et={class:"value"},tt={class:"detail-item"},st={class:"value"},ot={class:"room-actions"},it=["disabled"],at={key:2,class:"game-container"},nt={class:"input-group"},rt=["max"],lt={class:"modal-actions"},dt=["disabled"];function ct(o,e,r,c,t,n){var b,v,_,k,C,N,S;const p=Y("GameRoom");return a(),i("div",Ue,[t.loading?(a(),i("div",Le,[...e[6]||(e[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading your bingo experience...",-1)])])):t.currentView==="rooms"?(a(),i("div",qe,[s("header",Ve,[s("div",Ee,[s("div",xe,l(((v=(b=t.username)==null?void 0:b.charAt(0))==null?void 0:v.toUpperCase())||"P"),1),s("div",De,[s("h3",null,l(t.username||"Player"),1),s("p",Ye,l(((_=t.user)==null?void 0:_.balance)||0)+" coins",1)])]),s("button",{onClick:e[0]||(e[0]=(...d)=>n.requestWithdraw&&n.requestWithdraw(...d)),class:"withdraw-btn",disabled:!((k=t.user)!=null&&k.balance)}," ðŸ’° Withdraw ",8,ze)]),s("main",He,[e[9]||(e[9]=s("h2",{class:"section-title"},"ðŸŽ¯ Active Bingo Rooms",-1)),s("div",Ke,[(a(!0),i(f,null,g(t.rooms,d=>{var W;return a(),i("div",{key:d.id,class:y(["room-card",{full:d.playerCount>=d.maxPlayers,playing:d.status==="playing"}]),onClick:R=>n.joinRoom(d.id)},[s("div",Xe,[s("h3",null,l(d.name),1),s("span",{class:y(["room-status",d.status])},l(d.status),3)]),s("div",Ze,[s("div",$e,[e[7]||(e[7]=s("span",{class:"label"},"Bet Amount:",-1)),s("span",et,l(d.betAmount)+" coins",1)]),s("div",tt,[e[8]||(e[8]=s("span",{class:"label"},"Players:",-1)),s("span",st,l(d.playerCount)+"/"+l(d.maxPlayers),1)])]),s("div",ot,[s("button",{class:"join-btn",disabled:d.playerCount>=d.maxPlayers||((W=t.user)==null?void 0:W.balance)<d.betAmount},l(d.status==="playing"?"ðŸŽ® Game in Progress":"ðŸŽ¯ Join Game"),9,it)])],10,Qe)}),128))])])])):t.currentView==="game"?(a(),i("div",at,[V(p,{"room-id":t.currentRoomId,user:t.user,onBackToRooms:n.backToRooms,onUpdateBalance:n.updateUserBalance},null,8,["room-id","user","onBackToRooms","onUpdateBalance"])])):m("",!0),t.showWithdrawModal?(a(),i("div",{key:3,class:"modal-overlay",onClick:e[5]||(e[5]=d=>t.showWithdrawModal=!1)},[s("div",{class:"modal",onClick:e[4]||(e[4]=D(()=>{},["stop"]))},[e[10]||(e[10]=s("h3",null,"ðŸ’° Request Withdrawal",-1)),s("div",nt,[s("label",null,"Amount (max "+l(((C=t.user)==null?void 0:C.balance)||0)+" coins):",1),E(s("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=d=>t.withdrawAmount=d),max:((N=t.user)==null?void 0:N.balance)||0,min:"1",placeholder:"Enter amount"},null,8,rt),[[x,t.withdrawAmount]])]),s("div",lt,[s("button",{onClick:e[2]||(e[2]=d=>t.showWithdrawModal=!1),class:"cancel-btn"},"Cancel"),s("button",{onClick:e[3]||(e[3]=(...d)=>n.submitWithdraw&&n.submitWithdraw(...d)),class:"confirm-btn",disabled:!t.withdrawAmount||t.withdrawAmount>((S=t.user)==null?void 0:S.balance)}," Submit Request ",8,dt)])])])):m("",!0),t.notification?(a(),i("div",{key:4,class:y(["notification",t.notification.type])},l(t.notification.message),3)):m("",!0)])}const ut=U(Je,[["render",ct]]);window.Telegram.WebApp.ready();window.Telegram.WebApp.expand();const L=new URLSearchParams(window.location.search),J=L.get("userId"),mt=L.get("username");if(!J)document.body.innerHTML='<div style="padding: 20px; text-align: center; color: white;">Please start the bot first!</div>';else{const o=z(ut);o.config.globalProperties.$userId=J,o.config.globalProperties.$username=mt,o.mount("#app")}
